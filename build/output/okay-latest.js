// Okay.JS
// by Hunter Loftis <hunter@hunterloftis.com>
//
// Version 0.1.0
window.ok=window.ok||{};
(function(c,d){function a(b){b._subscriptions=[];b.subscribe=f.subscribe;b.publish=f.publish;b.unsubscribe=f.unsubscribe;b.__isSubscribable=!0}c.dom={};c.template={};c.binding={};var b,h,k={},f={subscribe:function(b,a){this._subscriptions.push({callback:b,context:a||this});b._publishers=b._publishers||[];d(b._publishers).contains(this)||b._publishers.push(this)},publish:function(b){d(this._subscriptions).each(function(a){a.callback.call(a.context,b)},this)},unsubscribe:function(b){this._subscriptions=d(this._subscriptions).reject(function(a){return a.callback===
b});b._publishers=d(b._publishers).without(this)}};c.base=function(d){function c(){if(arguments.length>0)return g!==arguments[0]&&(g=arguments[0],c.publish(g)),this;b&&h.push(c);return g}var g=d;a(c);return c};c.collection=function(c){function i(){if(arguments.length>0)return e=arguments[0],i.publish(e),this;b&&h.push(i);return e}function g(b){return function(){typeof e==="undefined"&&(e=[]);var a=e[b].apply(e,arguments);i.publish(e);return a}}var e=c;d(["pop","push","reverse","shift","sort","splice",
"unshift"]).each(function(b){i[b]=g(b)});a(i);return i};c.dependent=function(c,i){function g(){b&&h.push(g);return f}function e(){var a=e._publishers?e._publishers.slice():[],k;b=!0;h=[];f=c.call(i);b=!1;k=h=d.uniq(h);var m=d(a).select(function(b){return!d(k).contains(b)}),n=d(k).select(function(b){return!d(a).contains(b)});d(m).each(function(b){b.unsubscribe(e)});d(n).each(function(b){b.subscribe(e)});g.publish(f)}var f;a(g);e();return g};c.bind=function(b,a,h){var a=a||"",e="data-bind"+(a.length>
0?"-"+a:""),h=c.dom.nodesWithAttr(e,h),f=k[a]=[];d(h).each(function(a){var h=c.dom.attr(a,e);with(b)eval("var bindingObject = {"+h+"}");d.each(bindingObject,function(d,h){var e=c.binding[h](a,d,b);f.push(e)})})};c.unbind=function(b){var b=b||"",a=k[b];if(a)d(a).each(function(b){b.release()}),k[b]=[];else throw Error("Nothing is bound to namespace '"+b+"'");};c.safeSubscribe=function(b,a,c){b.subscribe?(b.subscribe(a,c),a.call(c,b())):a.call(c,b)}})(window.ok,window._);
(function(c,d){var a=c.dom;a.nodesWithAttr=function(b,a){if(a)return d(a).find("*["+b+"]");return d("*["+b+"]")};a.createNode=function(b){return d(b)};a.append=function(b,a){d(b).append(a)};a.remove=function(b){d(b).remove()};a.after=function(b,a){d(b).after(a)};a.before=function(b,a){d(b).before(a)};a.attr=function(b,a){return d(b).attr(a)};a.show=function(b){d(b).show()};a.hide=function(b){d(b).hide()};a.text=function(b,a){d(b).html(a)};a.html=function(b,a){return d(b).html(a)};a.value=function(b,
a){return d(b).val(a)};a.bind=function(b,a,c,f){var j=function(){c.call(f)};d(b).bind(a,j);return j};a.unbind=function(b,a,c){d(b).unbind(a,c)}})(window.ok,window.Zepto);(function(c,d){c.template.render=function(a,b){return d.template(a,b)}})(window.ok,window._);
(function(c){function d(a,b){this.node=a;this.subscribable=b;c.safeSubscribe(b,this.update,this)}d.prototype={update:function(a){a?c.dom.show(this.node):c.dom.hide(this.node)},release:function(){this.subscribable.unsubscribe(this.update)}};c.binding.visible=function(a,b){return new d(a,b)}})(ok);
(function(c){function d(a,b){this.node=a;this.subscribable=b;c.safeSubscribe(b,this.update,this)}d.prototype={update:function(a){c.dom.html(this.node,a)},release:function(){this.subscribable.unsubscribe(this.update)}};c.binding.html=function(a,b){return new d(a,b)}})(ok);
(function(c){function d(a,b){this.node=a;this.callback=b;$(a).bind("click",_.bind(this.activate,this))}d.prototype={activate:function(a){this.callback()||(a.preventDefault(),a.stopPropagation())},release:function(){$(node).unbind("click",this.callback)}};c.binding.click=function(a,b){return new d(a,b)}})(ok);
(function(c){function d(a,b,c){this.node=a;this.callback=b;this.vm=c;$(a).bind("submit",_.bind(this.activate,this))}d.prototype={activate:function(a){this.callback.call(this.vm,[a])||(a.preventDefault(),a.stopPropagation())},release:function(){$(node).unbind("submit",this.callback)}};c.binding.submit=function(a,b,c){return new d(a,b,c)}})(ok);
(function(c){function d(a,b){this.node=a;this.subscribable=b;b.subscribe(this.updateNode,this);this.updateNode(b());this.keyup_handler=c.dom.bind(a,"keyup",this.updateSubscribable,this)}d.prototype={updateNode:function(a){c.dom.value(this.node,a)},updateSubscribable:function(){this.subscribable(c.dom.value(this.node))},release:function(){this.subscribable.unsubscribe(this.updateNode);c.dom.unbind(this.node,"keyup",this.keyup_handler)}};c.binding.value=function(a,b){return new d(a,b)}})(ok);
(function(c){function d(a,b){this.node=a;this.templateId="#"+b.template;this.subscribable=b.collection;this._items=[];c.dom.html(this.node,"");c.safeSubscribe(this.subscribable,this.update,this)}d.prototype={update:function(a){var b=this,d=c.dom.html(this.templateId),k=_(this._items).pluck("data"),f,j,i=[];_(a).each(function(a,g){if(b._items.length>g)if(f=b._items[g],f.data===a)i.push(f);else{var l=_(k).indexOf(a);l>=0?(c.dom.before(f.node,b._items[l].node),i.push(b._items[l])):(j=c.dom.createNode(c.template.render(d,
a)),c.bind(a,null,j),c.dom.before(f.node,j),i.push({data:a,node:j}))}else j=c.dom.createNode(c.template.render(d,a)),c.bind(a,null,j),c.dom.append(b.node,j),i.push({data:a,node:j})});var g=[];_(this._items).each(function(b){_(a).contains(b.data)||g.push(b)});_(g).each(function(a){c.dom.remove(a.node)});this._items=i},release:function(){this.subscribable.unsubscribe(this.update)}};c.binding.repeat=function(a,b,c){return new d(a,b,c)}})(ok);
