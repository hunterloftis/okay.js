// Okay.JS
// by Hunter Loftis <hunter@hunterloftis.com>
//
// Version 0.1.0
window.ok=window.ok||{};
(function(c,d){function a(){var b=d.uniq(g.pop());g.length===0&&(i=!1);h=d(g).last();return b}function b(b){b._subscriptions=[];b.subscribe=j.subscribe;b.publish=j.publish;b.unsubscribe=j.unsubscribe;b.__isSubscribable=!0}c.dom={};c.template={};c.binding={};var i=!1,g=[],h=null,f={},j={subscribe:function(b,a){this._subscriptions.push({callback:b,context:a||this});b._publishers=b._publishers||[];d(b._publishers).contains(this)||b._publishers.push(this)},publish:function(b){d(this._subscriptions).each(function(a){a.callback.call(a.context,b)},
this)},unsubscribe:function(b){this._subscriptions=d(this._subscriptions).reject(function(a){return a.callback===b});b._publishers=d(b._publishers).without(this)}};c.base=function(a){function d(){if(arguments.length>0)return c!==arguments[0]&&(c=arguments[0],d.publish(c)),this;i&&h.push(d);return c}var c=a;b(d);return d};c.collection=function(a){function c(){if(arguments.length>0)return e=arguments[0],c.publish(e),this;i&&h.push(c);return e}function k(b){return function(){typeof e==="undefined"&&
(e=[]);var a=e[b].apply(e,arguments);c.publish(e);return a}}var e=a;d(["pop","push","reverse","shift","sort","splice","unshift"]).each(function(b){c[b]=k(b)});b(c);return c};c.dependent=function(c,l){function k(){i&&h.push(k);return f}function e(){var b=e._publishers?e._publishers.slice():[],j;i=!0;h=[];g.push(h);f=c.call(l);j=a();var n=d(b).select(function(b){return!d(j).contains(b)}),o=d(j).select(function(a){return!d(b).contains(a)});d(n).each(function(b){b.unsubscribe(e)});d(o).each(function(b){b.subscribe(e)});
k.publish(f)}var f;b(k);e();return k};c.dep=function(b,a){var d=new Function("return "+b);return c.dependent(d,a)};c.bind=function(b,a,i){var a=a||"",e="data-bind"+(a.length>0?"-"+a:""),i=c.dom.nodesWithAttr(e,i),g=f[a]=[];d(i).each(function(a){var i=c.dom.attr(a,e);with(b)eval("var bindingObject = {"+i+"}");d.each(bindingObject,function(d,i){var l=c.binding[i](a,d,b);l instanceof Array?g.concat(l):g.push(l)})})};c.unbind=function(b){var b=b||"",a=f[b];if(a)d(a).each(function(b){b.release()}),f[b]=
[];else throw Error("Nothing is bound to namespace '"+b+"'");};c.safeSubscribe=function(b,a,c){b.subscribe?(b.subscribe(a,c),a.call(c,b())):a.call(c,b)}})(window.ok,window._);(function(c){(c.utils={}).toJSON=function a(b){if(typeof b==="function"){if(b.__isSubscribable)return a(b())}else if(typeof b==="object"){var c;c=b instanceof Array?[]:{};for(var g in b)c[g]=a(b[g]);return c}else return b}})(ok,_);
(function(c,d){var a=c.dom;a.nodesWithAttr=function(b,a){var c="*["+b+"]";if(a){var h=d(a).find("*["+b+"]");if(d(a).is(c))return d(a).add(h);return h}return d(c)};a.createNode=function(b){return d(b)};a.append=function(b,a){d(b).append(a)};a.remove=function(b){d(b).remove()};a.after=function(b,a){d(b).after(a)};a.before=function(b,a){d(b).before(a)};a.attr=function(b,a){return d(b).attr(a)};a.show=function(b){d(b).show()};a.hide=function(b){d(b).hide()};a.text=function(b,a){d(b).html(a)};a.html=function(b,
a){return d(b).html(a)};a.value=function(b,a){return d(b).val(a)};a.bind=function(b,a,c,h){var f=function(){c.call(h)};d(b).bind(a,f);return f};a.unbind=function(a,c,g){d(a).unbind(c,g)}})(window.ok,window.Zepto);(function(c,d){c.template.render=function(a,b){return d.template(a,b)}})(window.ok,window._);
(function(c){function d(a,b){this.node=a;this.subscribable=b;c.safeSubscribe(b,this.update,this)}d.prototype={update:function(a){a?c.dom.show(this.node):c.dom.hide(this.node)},release:function(){this.subscribable.unsubscribe(this.update)}};c.binding.visible=function(a,b){return new d(a,b)}})(ok);
(function(c){function d(a,b){this.node=a;this.subscribable=b;c.safeSubscribe(b,this.update,this)}d.prototype={update:function(a){c.dom.html(this.node,a)},release:function(){this.subscribable.unsubscribe(this.update)}};c.binding.html=function(a,b){return new d(a,b)}})(ok);
(function(c){function d(a,b,c){this.node=a;this.callback=b;this.vm=c;$(a).bind("click",_.bind(this.activate,this))}d.prototype={activate:function(a){this.callback.call(this.vm,[a])||(a.preventDefault(),a.stopPropagation())},release:function(){$(node).unbind("click",this.callback)}};c.binding.click=function(a,b,c){return new d(a,b,c)}})(ok);
(function(c){function d(a,b,c){this.node=a;this.callback=b;this.vm=c;$(a).bind("submit",_.bind(this.activate,this))}d.prototype={activate:function(a){this.callback.call(this.vm,[a])||(a.preventDefault(),a.stopPropagation())},release:function(){$(node).unbind("submit",this.callback)}};c.binding.submit=function(a,b,c){return new d(a,b,c)}})(ok);
(function(c){function d(a,b,c){this.node=a;this.callback=b;this.vm=c;$.os.ios||$.os.android||$.os.webos||$.os.touchpad||$.os.iphone||$.os.ipad||$.os.blackberry?($(a).bind("tap",_.bind(this.activate,this)),$(a).bind("touchstart",_.bind(this.btn_down,this)),$(a).bind("touchend",_.bind(this.btn_up,this))):($(a).bind("click",_.bind(this.activate,this)),$(a).bind("mousedown",_.bind(this.btn_down,this)),$(a).bind("mouseup",_.bind(this.btn_up,this)))}d.prototype={activate:function(a){this.callback.call(this.vm,
[a])||(a.preventDefault(),a.stopPropagation())},release:function(){},btn_down:function(){$(this.node).addClass("ok_down")},btn_up:function(){$(this.node).removeClass("ok_down")}};c.binding.tap=function(a,b,c){return new d(a,b,c)}})(ok);
(function(c){function d(a,b){this.node=a;this.subscribable=b;b.subscribe(this.updateNode,this);this.updateNode(b());this.keyup_handler=c.dom.bind(a,"keyup",this.updateSubscribable,this)}d.prototype={updateNode:function(a){c.dom.value(this.node,a)},updateSubscribable:function(){this.subscribable(c.dom.value(this.node))},release:function(){this.subscribable.unsubscribe(this.updateNode);c.dom.unbind(this.node,"keyup",this.keyup_handler)}};c.binding.value=function(a,b){return new d(a,b)}})(ok);
(function(c){function d(a,b){this.node=a;this.templateId="#"+b.template;this.subscribable=b.collection;this._items=[];c.dom.html(this.node,"");c.safeSubscribe(this.subscribable,this.update,this)}d.prototype={update:function(a){var b=this,d=c.dom.html(this.templateId),g=_(this._items).pluck("data"),h,f,j=[];_(a).each(function(a,k){if(b._items.length>k)if(h=b._items[k],h.data===a)j.push(h);else{var e=_(g).indexOf(a);e>=0?(c.dom.before(h.node,b._items[e].node),j.push(b._items[e])):(f=c.dom.createNode(c.template.render(d,
a)),c.dom.before(h.node,f),c.bind(a,null,f),j.push({data:a,node:f}))}else f=c.dom.createNode(c.template.render(d,a)),c.dom.append(b.node,f),c.bind(a,null,f),j.push({data:a,node:f})});var m=[];_(this._items).each(function(b){_(a).contains(b.data)||m.push(b)});_(m).each(function(a){c.dom.remove(a.node)});this._items=j},release:function(){this.subscribable.unsubscribe(this.update)}};c.binding.repeat=function(a,b,c){return new d(a,b,c)}})(ok);
(function(c){function d(a,b,d){this.node=a;this.className=b;this.subscribable=d;c.safeSubscribe(d,this.update,this)}d.prototype={update:function(a){a?$(this.node).addClass(this.className):$(this.node).removeClass(this.className)},release:function(){this.subscribable.unsubscribe(this.update)}};c.binding.css=function(a,b){var c=[],g;for(g in b)c.push(new d(a,g,b[g]));return c}})(ok);
