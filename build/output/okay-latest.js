// Okay.JS
// by Hunter Loftis <hunter@hunterloftis.com>
//
// Version 0.1.0
window.ok=window.ok||{};
(function(c,d){function a(b){b._subscriptions=[];b.subscribe=f.subscribe;b.publish=f.publish;b.unsubscribe=f.unsubscribe;b.__isSubscribable=!0}c.dom={};c.template={};c.binding={};var b,i,h={},f={subscribe:function(b,a){this._subscriptions.push({callback:b,context:a||this});b._publishers=b._publishers||[];d(b._publishers).contains(this)||b._publishers.push(this)},publish:function(b){d(this._subscriptions).each(function(a){a.callback.call(a.context,b)},this)},unsubscribe:function(b){this._subscriptions=d(this._subscriptions).reject(function(a){return a.callback===
b});b._publishers=d(b._publishers).without(this)}};c.base=function(c){function d(){if(arguments.length>0)return g!==arguments[0]&&(g=arguments[0],d.publish(g)),this;b&&i.push(d);return g}var g=c;a(d);return d};c.collection=function(c){function j(){if(arguments.length>0)return e=arguments[0],j.publish(e),this;b&&i.push(j);return e}function g(b){return function(){typeof e==="undefined"&&(e=[]);var a=e[b].apply(e,arguments);j.publish(e);return a}}var e=c;d(["pop","push","reverse","shift","sort","splice",
"unshift"]).each(function(b){j[b]=g(b)});a(j);return j};c.dependent=function(c,j){function g(){b&&i.push(g);return h}function e(){var a=e._publishers?e._publishers.slice():[],f;b=!0;i=[];h=c.call(j);b=!1;f=i=d.uniq(i);var m=d(a).select(function(b){return!d(f).contains(b)}),n=d(f).select(function(b){return!d(a).contains(b)});d(m).each(function(b){b.unsubscribe(e)});d(n).each(function(b){b.subscribe(e)});g.publish(h)}var h;a(g);e();return g};c.bind=function(b,a,i){var a=a||"",e="data-bind"+(a.length>
0?"-"+a:""),i=c.dom.nodesWithAttr(e,i),f=h[a]=[];d(i).each(function(a){var i=c.dom.attr(a,e);with(b)eval("var bindingObject = {"+i+"}");d.each(bindingObject,function(d,i){var e=c.binding[i](a,d,b);e instanceof Array?f.concat(e):f.push(e)})})};c.unbind=function(b){var b=b||"",a=h[b];if(a)d(a).each(function(b){b.release()}),h[b]=[];else throw Error("Nothing is bound to namespace '"+b+"'");};c.safeSubscribe=function(b,a,d){b.subscribe?(b.subscribe(a,d),a.call(d,b())):a.call(d,b)}})(window.ok,window._);
(function(c){(c.utils={}).toJSON=function a(b){if(typeof b==="function"){if(b.__isSubscribable)return a(b())}else if(typeof b==="object"){var c;c=b instanceof Array?[]:{};for(var h in b)c[h]=a(b[h]);return c}else return b}})(ok,_);
(function(c,d){var a=c.dom;a.nodesWithAttr=function(b,a){if(a)return d(a).find("*["+b+"]");return d("*["+b+"]")};a.createNode=function(b){return d(b)};a.append=function(b,a){d(b).append(a)};a.remove=function(b){d(b).remove()};a.after=function(b,a){d(b).after(a)};a.before=function(b,a){d(b).before(a)};a.attr=function(b,a){return d(b).attr(a)};a.show=function(b){d(b).show()};a.hide=function(b){d(b).hide()};a.text=function(b,a){d(b).html(a)};a.html=function(b,a){return d(b).html(a)};a.value=function(b,
a){return d(b).val(a)};a.bind=function(b,a,c,f){var k=function(){c.call(f)};d(b).bind(a,k);return k};a.unbind=function(b,a,c){d(b).unbind(a,c)}})(window.ok,window.Zepto);(function(c,d){c.template.render=function(a,b){return d.template(a,b)}})(window.ok,window._);
(function(c){function d(a,b){this.node=a;this.subscribable=b;c.safeSubscribe(b,this.update,this)}d.prototype={update:function(a){a?c.dom.show(this.node):c.dom.hide(this.node)},release:function(){this.subscribable.unsubscribe(this.update)}};c.binding.visible=function(a,b){return new d(a,b)}})(ok);
(function(c){function d(a,b){this.node=a;this.subscribable=b;c.safeSubscribe(b,this.update,this)}d.prototype={update:function(a){c.dom.html(this.node,a)},release:function(){this.subscribable.unsubscribe(this.update)}};c.binding.html=function(a,b){return new d(a,b)}})(ok);
(function(c){function d(a,b,c){this.node=a;this.callback=b;this.vm=c;$(a).bind("click",_.bind(this.activate,this))}d.prototype={activate:function(a){this.callback.call(this.vm,[a])||(a.preventDefault(),a.stopPropagation())},release:function(){$(node).unbind("click",this.callback)}};c.binding.click=function(a,b,c){return new d(a,b,c)}})(ok);
(function(c){function d(a,b,c){this.node=a;this.callback=b;this.vm=c;$(a).bind("submit",_.bind(this.activate,this))}d.prototype={activate:function(a){this.callback.call(this.vm,[a])||(a.preventDefault(),a.stopPropagation())},release:function(){$(node).unbind("submit",this.callback)}};c.binding.submit=function(a,b,c){return new d(a,b,c)}})(ok);
(function(c){function d(a,b,c){this.node=a;this.callback=b;this.vm=c;$(a).bind("tap",_.bind(this.activate,this))}d.prototype={activate:function(a){this.callback.call(this.vm,[a])||(a.preventDefault(),a.stopPropagation())},release:function(){$(node).unbind("tap",this.callback)}};c.binding.tap=function(a,b,c){return new d(a,b,c)}})(ok);
(function(c){function d(a,b){this.node=a;this.subscribable=b;b.subscribe(this.updateNode,this);this.updateNode(b());this.keyup_handler=c.dom.bind(a,"keyup",this.updateSubscribable,this)}d.prototype={updateNode:function(a){c.dom.value(this.node,a)},updateSubscribable:function(){this.subscribable(c.dom.value(this.node))},release:function(){this.subscribable.unsubscribe(this.updateNode);c.dom.unbind(this.node,"keyup",this.keyup_handler)}};c.binding.value=function(a,b){return new d(a,b)}})(ok);
(function(c){function d(a,b){this.node=a;this.templateId="#"+b.template;this.subscribable=b.collection;this._items=[];c.dom.html(this.node,"");c.safeSubscribe(this.subscribable,this.update,this)}d.prototype={update:function(a){var b=this,d=c.dom.html(this.templateId),h=_(this._items).pluck("data"),f,k,j=[];_(a).each(function(a,g){if(b._items.length>g)if(f=b._items[g],f.data===a)j.push(f);else{var l=_(h).indexOf(a);l>=0?(c.dom.before(f.node,b._items[l].node),j.push(b._items[l])):(k=c.dom.createNode(c.template.render(d,
a)),c.bind(a,null,k),c.dom.before(f.node,k),j.push({data:a,node:k}))}else k=c.dom.createNode(c.template.render(d,a)),c.bind(a,null,k),c.dom.append(b.node,k),j.push({data:a,node:k})});var g=[];_(this._items).each(function(b){_(a).contains(b.data)||g.push(b)});_(g).each(function(a){c.dom.remove(a.node)});this._items=j},release:function(){this.subscribable.unsubscribe(this.update)}};c.binding.repeat=function(a,b,c){return new d(a,b,c)}})(ok);
(function(c){function d(a,b,d){this.node=a;this.className=b;this.subscribable=d;c.safeSubscribe(d,this.update,this)}d.prototype={update:function(a){a?$(this.node).addClass(this.className):$(this.node).removeClass(this.className)},release:function(){this.subscribable.unsubscribe(this.update)}};c.binding.css=function(a,b){var c=[],h;for(h in b)c.push(new d(a,h,b[h]));return c}})(ok);
