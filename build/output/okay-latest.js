// Okay.JS
// by Hunter Loftis <hunter@hunterloftis.com>
//
// Version 0.1.0
window.ok=window.ok||{};
(function(c,h){var k,f,e;function g(a){a.subscribe=k;a.publish=f;a.unsubscribe=e;a._publishesToHash={};a._subscribesTo={};a._isSubscribable=true;a._subscriber_hash=q++}function i(){this.functions=[];this.running=false}c.dom={};c.template={};c.binding={};c.debug={};c.debug.SUBSCRIPTION_COUNT=0;c.debug.UPDATE_COUNT=0;var n=false,o=[],l=null,p={},q=1;k=function(a){var b=a._subscriber_hash=a._subscriber_hash||q++;if(!this._publishesToHash[b])this._publishesToHash[b]=a,c.debug.SUBSCRIPTION_COUNT++,a._subscribesTo=
a._subscribesTo||{},a._subscribesTo[this._subscriber_hash]=this};f=function(a){h(this._publishesToHash).each(function(b){b(a)},this)};e=function(a){c.debug.SUBSCRIPTION_COUNT--;delete a._subscribesTo[this._subscriber_hash];delete this._publishesToHash[a._subscriber_hash]};c.base=function(a){function b(){if(arguments.length>0)return c!==arguments[0]&&(c=arguments[0],b.publish(c)),this;n&&l.push(b);return c}var c=a;g(b);return b};c.collection=function(a){function b(){if(arguments.length>0)return d=
arguments[0],b.publish(d),this;n&&l.push(b);return d}function c(a){return function(){typeof d==="undefined"&&(d=[]);var c=d[a].apply(d,arguments);b.publish(d);return c}}var d=a;h("pop,push,reverse,shift,sort,splice,unshift".split(",")).each(function(a){b[a]=c(a)});g(b);return b};i.prototype={push:function(a){h(this.functions).indexOf(a)===-1&&(this.functions.push(a),this.running||this.run())},run:function(){this.running=true;for(var a=this.functions.length,a=a>3?3:a;a--;);(a=this.functions.shift())?
a(this.complete):this.running=false},complete:function(){setTimeout(function(){r.run()},1)}};var r=new i;c.dependent=function(a,b){function j(){n&&l.push(j);return f}function d(){c.debug.UPDATE_COUNT++;var e=d._subscribesTo;n=true;l=[];o.push(l);var g=f;f=a.call(b);var s=h.uniq(o.pop());o.length===0&&(n=false);l=h(o).last();var m;for(m=e.length;m--;)e[m].unsubscribe(d);for(m=s.length;m--;)s[m].subscribe(d);f!==g&&j.publish(f)}var f;g(j);g(d);d();return j};c.dep=function(a,b){var j=new Function("return "+
a);return c.dependent(j,b)};c.bind=function(a,b,j){var b=b||"",d="data-bind"+(b.length>0?"-"+b:""),f="data-watch"+(b.length>0?"-"+b:""),e=c.dom.nodesWithAttr(d,j),g=p[b]=[];h(e).each(function(b){var j=c.dom.attr(b,d);with(a)eval("var bindingObject = {"+j+"}");h.each(bindingObject,function(j,d){var f=c.binding[d](b,j,a,false);f instanceof Array?g.concat(f):g.push(f)})});b=c.dom.nodesWithAttr(f,j);h(b).each(function(b){var j=c.dom.attr(b,f);with(a)eval("var bindingObject = {"+j+"}");h.each(bindingObject,
function(j,d){var f=c.binding[d](b,j,a,true);f instanceof Array?g.concat(f):g.push(f)})});return g};c.unbind=function(a){var a=a||"",b=p[a];if(b)h(b).each(function(a){a.release()}),p[a]=[];else throw Error("Nothing is bound to namespace '"+a+"'");};c.safeSubscribe=function(a,b,c){b=h(b).bind(c);if(a){if(a.subscribe)return a.subscribe(b),b(a()),b;b(a);return b}}})(window.ok,window._);
(function(c){(c.utils={}).toJSON=function k(c,e){typeof e==="undefined"&&(e=0);e++;if(!(e>5))if(typeof c==="function"){if(c._isSubscribable)return k(c(),e)}else if(typeof c==="object"){var g;g=c instanceof Array?[]:{};for(var i in c)g[i]=k(c[i],e);return g}else return c}})(ok,_);window.ok=window.ok||{};
(function(c,h){var k,f,e;function g(a){a.subscribe=k;a.publish=f;a.unsubscribe=e;a._publishesToHash={};a._subscribesTo={};a._isSubscribable=true;a._subscriber_hash=q++}function i(){this.functions=[];this.running=false}c.dom={};c.template={};c.binding={};c.debug={};c.debug.SUBSCRIPTION_COUNT=0;c.debug.UPDATE_COUNT=0;var n=false,o=[],l=null,p={},q=1;k=function(a){var b=a._subscriber_hash=a._subscriber_hash||q++;if(!this._publishesToHash[b])this._publishesToHash[b]=a,c.debug.SUBSCRIPTION_COUNT++,a._subscribesTo=
a._subscribesTo||{},a._subscribesTo[this._subscriber_hash]=this};f=function(a){h(this._publishesToHash).each(function(b){b(a)},this)};e=function(a){c.debug.SUBSCRIPTION_COUNT--;delete a._subscribesTo[this._subscriber_hash];delete this._publishesToHash[a._subscriber_hash]};c.base=function(a){function b(){if(arguments.length>0)return c!==arguments[0]&&(c=arguments[0],b.publish(c)),this;n&&l.push(b);return c}var c=a;g(b);return b};c.collection=function(a){function b(){if(arguments.length>0)return d=
arguments[0],b.publish(d),this;n&&l.push(b);return d}function c(a){return function(){typeof d==="undefined"&&(d=[]);var c=d[a].apply(d,arguments);b.publish(d);return c}}var d=a;h("pop,push,reverse,shift,sort,splice,unshift".split(",")).each(function(a){b[a]=c(a)});g(b);return b};i.prototype={push:function(a){h(this.functions).indexOf(a)===-1&&(this.functions.push(a),this.running||this.run())},run:function(){this.running=true;for(var a=this.functions.length,a=a>3?3:a;a--;);(a=this.functions.shift())?
a(this.complete):this.running=false},complete:function(){setTimeout(function(){r.run()},1)}};var r=new i;c.dependent=function(a,b){function f(){n&&l.push(f);return e}function d(){c.debug.UPDATE_COUNT++;var g=d._subscribesTo;n=true;l=[];o.push(l);var k=e;e=a.call(b);var i=h.uniq(o.pop());o.length===0&&(n=false);l=h(o).last();var m;for(m=g.length;m--;)g[m].unsubscribe(d);for(m=i.length;m--;)i[m].subscribe(d);e!==k&&f.publish(e)}var e;g(f);g(d);d();return f};c.dep=function(a,b){var f=new Function("return "+
a);return c.dependent(f,b)};c.bind=function(a,b,f){var b=b||"",d="data-bind"+(b.length>0?"-"+b:""),e="data-watch"+(b.length>0?"-"+b:""),g=c.dom.nodesWithAttr(d,f),i=p[b]=[];h(g).each(function(b){var f=c.dom.attr(b,d);with(a)eval("var bindingObject = {"+f+"}");h.each(bindingObject,function(f,d){var e=c.binding[d](b,f,a,false);e instanceof Array?i.concat(e):i.push(e)})});b=c.dom.nodesWithAttr(e,f);h(b).each(function(b){var f=c.dom.attr(b,e);with(a)eval("var bindingObject = {"+f+"}");h.each(bindingObject,
function(f,d){var e=c.binding[d](b,f,a,true);e instanceof Array?i.concat(e):i.push(e)})});return i};c.unbind=function(a){var a=a||"",b=p[a];if(b)h(b).each(function(a){a.release()}),p[a]=[];else throw Error("Nothing is bound to namespace '"+a+"'");};c.safeSubscribe=function(a,b,c){b=h(b).bind(c);if(a){if(a.subscribe)return a.subscribe(b),b(a()),b;b(a);return b}}})(window.ok,window._);
(function(c){(c.utils={}).toJSON=function k(c,e){typeof e==="undefined"&&(e=0);e++;if(!(e>5))if(typeof c==="function"){if(c._isSubscribable)return k(c(),e)}else if(typeof c==="object"){var g;g=c instanceof Array?[]:{};for(var i in c)g[i]=k(c[i],e);return g}else return c}})(ok,_);
